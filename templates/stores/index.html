{% extends 'layouts/default.html' %} {% block main %} {% if user.is_member %}
<div class="container mx-auto p-4">
  <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
    {% for store in stores %}
    <div class="bg-white rounded-xl shadow-md overflow-hidden relative">
      <a href="{% url 'stores:show' store.id %}">
        <!-- 商家圖片 -->
        <div class="relative">
          <img src="{{ store.cover_url|default:'https://fakeimg.pl/400x250' }}" alt="店家封面" class="w-full h-48 object-cover" />

          <!-- Logo -->
          <img src="{{ store.logo_url|default:'https://fakeimg.pl/50x50/' }}" alt="Logo" class="absolute top-2 left-2 w-10 h-10 rounded-full border-2 border-white" />

          <!-- 愛心，後續這個可以用annotate操作，一次查詢全部的店家是否有被該會員收藏 -->
          <div x-data class="absolute top-2 right-2 p-1.5 rounded-full hover:bg-red-50 cursor-pointer flex items-center" @click.stop>{% include "shared/favorite_btn.html" with store=store member=user.member %}</div>
        </div>

        <!-- 商家資訊 -->
        <div class="p-4">
          <h2 class="text-lg font-semibold">{{ store.name }}</h2>
          <p class="text-sm text-gray-600">{{ store.address }}</p>
          <p class="text-sm text-gray-600">營業時間：{{ store.opening_time }}<span>~</span>{{ store.closing_time }}</p>
          <div class="flex items-center justify-between mt-2 text-sm text-gray-500">
            <!-- 功能尚未導入
            <span>距離：{{ store.distance }} 公里</span>
            -->
            <span>⭐ {{ store.avg_rating|floatformat:1 }}</span>
                <form method="POST" action="{% url 'stores:rate_store' store.id %}">
      {% csrf_token %}
      <label class="block mb-1">你的評分：</label>
      <div class="rating rating-lg">
        {% for i in "12345" %}
        <!-- prettier-ignore -->
        <input type="radio" name="score" value="{{ forloop.counter }}" class="mask mask-star-2 bg-yellow-400" 
        {% if store.member_rating and store.member_rating.score == forloop.counter %}checked{% endif %} />
        {% endfor %}
      </div>
      {% if store.member_rating %}
      <button type="submit" class="btn btn-success btn-sm mt-2">已評分為 {{ store.member_rating.score }} 分</button>
      {% else %}
      <button type="submit" class="btn btn-sm mt-2 btn-neutral">送出評分</button>
      {% endif %}
    </form>
          </div>
        </div>
      </a>
    </div>
    {% endfor %}
</ul>
{% endif %}

<!-- 如果是店家 -->
{% if user.is_store %} {% if store %}
<section class="mt-6 p-4 border rounded shadow">
  <p class="font-bold text-lg">您的店家資訊：</p>
  <p>店家名稱：{{ store.name }}</p>
  <p>店家地址：{{ store.address }}</p>
  <p>店家電話：{{ store.phone_number }}</p>
  <p>店家統編：{{ store.tax_id }}</p>
  <p>開店時間：{{ store.opening_time }}</p>
  <p>打烊時間：{{ store.closing_time }}</p>
  <p class="mt-2 font-semibold">平均評分：{{ store.avg_rating|floatformat:1 }} 分</p>

  <div class="mt-4 space-x-2">
    <a href="{% url 'stores:edit' store.id %}" class="btn btn-outline">編輯店家資料</a>
    <a href="{% url 'stores:show' store.id %}" class="btn btn-secondary">前往店家頁面</a>
  </div>
</section>
{% else %}
<a href="{% url 'stores:new' %}" class="btn mt-6">新增店家資訊</a>
{% endif %} {% endif %} {% endblock %}
