  <form
  id="searchForm"
  action="{% url 'search:index' %}"
  method="get"
  class="flex flex-col gap-0 max-w-sm"
>
  <!-- 搜尋欄 -->
  <input
    id="searchInput"
    name="q"
    type="text"
    placeholder="搜尋商家、餐點或餐點卡路里"
    class="input input-bordered w-53"
    value="{{ request.GET.q }}"
  />

  <!-- 卡路里拉霸 -->
  <div
    id="calorieFilter"
    class="overflow-hidden max-h-0 transition-[max-height] duration-300"
    style="max-height: 0;"
  >
    <label for="max_calories" class="block text-xs mt-2">
      最多卡路里(非必填)：<span id="maxCalDisplay">{{ request.GET.max_calories|default:"0" }}</span>
    </label>
    <input
      type="range"
      id="max_calories"
      name="max_calories"
      min="0"
      max="1000"
      step="10"
      value="{{ request.GET.max_calories|default:"1000" }}"
      class="range w-56 h-3"
      oninput="document.getElementById('maxCalDisplay').textContent = this.value"
    />
  </div>


  <button id="searchBtn" type="submit" class="btn w-56 mt-2">搜尋</button>
</form>

<script>
  const searchInput = document.getElementById('searchInput');
  const calorieFilter = document.getElementById('calorieFilter');
  const searchForm = document.getElementById('searchForm');
  const searchBtn = document.getElementById('searchBtn');

  let isFilterOpen = false;

  function showFilter() {
    calorieFilter.style.maxHeight = calorieFilter.scrollHeight + 'px';
    isFilterOpen = true;
  }

  function hideFilter() {
    calorieFilter.style.maxHeight = '0';
    isFilterOpen = false;
  }


  searchInput.addEventListener('focus', showFilter);


  document.addEventListener('click', (e) => {
    const isClickInsideForm = searchForm.contains(e.target);
    if (!isClickInsideForm && isFilterOpen) {
      hideFilter();
    }
  });


  window.addEventListener('DOMContentLoaded', () => {
    if (searchInput.value.trim()) {
      showFilter();
    }
  });
</script>
