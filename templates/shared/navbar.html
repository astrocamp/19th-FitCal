{% load static %}
<div class="navbar bg-base-100 max-w-7xl mx-auto">
  <div class="flex-1">
    {% if user.is_authenticated %}
    <a href="{% url 'stores:index' %}"><img src="https://5x-fitcal.s3.ap-northeast-1.amazonaws.com/media/default/FitCal-Logo(new).webp" class="h-12" /></a>
    {% else %}
    <a href="{% url 'users:index' %}"><img src="https://5x-fitcal.s3.ap-northeast-1.amazonaws.com/media/default/FitCal-Logo(new).webp" class="h-12" /></a>
    {% endif %}
  </div>
  <div class="flex-none flex items-center gap-3">
    <!--- search bar -->
    {% load static %} {% comment %} åˆå§‹è³‡æ–™æ³¨å…¥ {% endcomment %} {% if user.is_authenticated %}
    <script>
      window.__initialSearchKeyword = "{{ request.GET.q|default:'' }}";
      window.__initialMaxCalories = parseInt("{{ request.GET.max_calories|default:'0' }}");
    </script>

    {% comment %} è¡¨å–® HTML {% endcomment %}
    <form x-data="searchFormComponent()" id="searchForm" action="{% url 'search:index' %}" method="get" class="relative w-full max-w-lg" @click.away="showFilter = false">
      <!--- ä¸Šæ’æœå°‹æ¬„ -->
      <div class="flex gap-3 items-center">
        <input id="searchInput" name="q" type="text" placeholder="æœå°‹å•†å®¶ã€é¤é»" class="input input-bordered w-53 pl-10" value="{{ request.GET.q }}"  />

        <!-- ğŸ”˜ ç¯©é¸ icon button -->
        <button type="button" @click="showFilter = !showFilter" class="btn">
          <i class="fa-solid fa-sliders "></i>
        </button>
        
        <!-- ğŸ”˜ æœå°‹æŒ‰éˆ• -->
        <button id="searchBtn" type="submit" class="btn">æœå°‹</button>
        <i class="fa-solid fa-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 z-20 pointer-events-none"></i>
      </div>

      <!-- ä¸‹æ’ï¼šæ‹‰éœ¸ï¼Œä½¿ç”¨çµ•å°å®šä½ -->
      <div id="calorieFilter" class="absolute left-0 w-full bg-white shadow-lg rounded mt-1 z-10 transition-all duration-300 overflow-hidden" x-ref="filter" x-bind:style="showFilter ? 'max-height:' + $refs.filter.scrollHeight + 'px' : 'max-height: 0;'">
        <div class="p-2">
          <label for="max_calories" class="block text-xs mb-1"> æœ€å¤šå¡è·¯é‡Œ(éå¿…å¡«)ï¼š<span x-text="maxCalories"></span> </label>
          <input type="range" id="max_calories" name="max_calories" min="0" max="1000" step="10" x-model="maxCalories" class="range w-full" />
        </div>
      </div>
    </form>

    {% comment %} å¼•å…¥æ‰“åŒ…å¾Œ JS {% endcomment %}
    <script type="module" src="{% static 'assets/scripts/app.js' %}"></script>
    {% endif %}
    <!--- å·²ç™»å…¥è³¼ç‰©è»Šå’Œå€‹äººè³‡æ–™ç‹€æ…‹ -->
    {% if user.is_authenticated %}
    <!--- è³¼ç‰©è»Š -->
    <a href="{% url 'carts:index' %}" class="btn btn-ghost btn-circle relative" tabindex="0">
      <div class="indicator">
        <span id="cart-count"> {% include "shared/cart_count.html" %} </span>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0 a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
        </svg>
      </div>
    </a>

    <!--- å€‹äººè³‡æ–™ -->
    <div class="dropdown dropdown-end">
      <div tabindex="0" role="button" class="btn btn-ghost btn-circle avatar" tabindex="0">
        <div class="w-10 rounded-full">
          <img alt="Tailwind CSS Navbar component" src="https://i.pinimg.com/736x/43/14/0a/43140a3803e5f1b39c1ffac1a35a3ec7.jpg" />
        </div>
      </div>

      <!--- å­é¸å–® -->
      <ul tabindex="0" class="menu dropdown-content bg-base-100 rounded-box z-1 mt-3 w-72 p-4 shadow gap-6">
        <li>
          <a href="{% url 'members:index' %}">æœƒå“¡è³‡æ–™</a>
        </li>
        <li>
          <!--- è£œä¸Šé€£çµ -->
          <a href="{% url 'members:favorite_list' %}">æ”¶è—å•†å®¶</a>
        </li>
        <li>
          <!--- è£œä¸Šé€£çµ -->
          <a href="{% url 'members:collections' %}">æ”¶è—å•†å“</a>
        </li>
        <li>
          <a href="{% url 'orders:index' %}">æ­·å²è¨‚å–®</a>
        </li>
        <li>
          <form action="{% url 'users:delete_session' %}" method="post">
            {% csrf_token %}
            <button type="submit" class="btn">ç™»å‡º</button>
          </form>
        </li>
      </ul>
    </div>
    {% else %}
    <!-- æœªç™»å…¥ç‹€æ…‹ï¼šç™»å…¥/è¨»å†ŠæŒ‰éˆ• -->
    <!-- æŒ‰éˆ•ï¼šæ‰“é–‹ modal -->
    <div id="signinModal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm" onclick="this.classList.add('hidden')">{% include "users/sign_in.html" %}</div>
    <button type="button" onclick="document.getElementById('signinModal').classList.remove('hidden')" class="btn btn-primary">ç™»å…¥ / è¨»å†Š</button>
    <br />
    <div id="signupModal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm" onclick="this.classList.add('hidden')">{% include "users/sign_up.html" %}</div>
    {% endif %}
  </div>
</div>
