{% load widget_tweaks %}
<div id="new-product" class="fixed inset-0 flex items-center justify-center z-50" style="background-color: rgba(0, 0, 0, 0.5)">
  <div class="bg-white rounded-xl shadow-xl p-6 w-full max-w-3xl max-h-[90vh] overflow-auto relative">
    <!-- Close Button -->
    <button class="btn btn-sm btn-circle absolute right-4 top-4" @click="document.getElementById('new-product').remove()">✕</button>

    <!-- 提示 + 類別名稱 -->
    <div class="mb-4">
      <p class="text-sm text-gray-500">新增商品</p>
      <h2 class="text-xl font-semibold text-gray-800">目前類別：{{ category.name }}</h2>
    </div>

    <form id="productForm" enctype="multipart/form-data" hx-post="{% url 'products:create' category.id %}" hx-target="#new-product" hx-swap="outerHTML" hx-vals='{"select_category": "{{ category.id }}"}' class="flex gap-6" x-data="{ imageUrl: '' }">
      {% csrf_token %}
      <!-- 左側表單 -->
      <div class="w-1/2 space-y-4">
        {% for field in form %}
        <div class="{% if field.name == 'description' %}h-20{% endif %}">
          <label class="block text-sm font-medium text-gray-700 mb-1">{{ field.label }}</label>
          {% if field.name == 'category' %} {{ field|add_class:"select select-bordered w-full" }} {% elif field.name == 'image' %} {{ field|add_class:"file-input file-input-bordered w-full" }} {% else %} {{ field|add_class:"input input-bordered w-full" }} {% endif %} {% if field.errors %}
          <div class="text-red-500 text-sm mt-1">{{ field.errors }}</div>
          {% endif %}
        </div>
        {% endfor %}

        <div class="flex justify-end">
          <input type="submit" value="新增商品" class="btn btn-primary" />
        </div>
      </div>

      <!-- 右側圖片預覽 -->
      <div class="w-1/2 flex justify-center items-start">
        <img x-show="imageUrl" :src="imageUrl" alt="預覽圖片" class="w-[200px] h-[200px] object-cover border rounded" />
      </div>
    </form>
  </div>
</div>
