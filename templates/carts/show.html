{% extends "layouts/default.html" %} {% block main %}
<!-- åº—å®¶è³‡è¨Šå€å¡Š -->
<div class="flex flex-col mt-5 mb-9 sm:flex-row items-start sm:items-center gap-4">
  <!-- LOGO -->
  <img src="{{ cart.store.logo_url|default:'https://fakeimg.pl/50x50/' }}" alt="åº—å®¶ Logo" class="w-24 h-24 rounded-lg object-cover border" />

  <!-- å•†å®¶è©³ç´°è³‡è¨Š -->
  <div class="space-y-1">
    <div class="flex items-center gap-2 text-xl font-bold">
      <span>{{ cart.store.name }}</span>
    </div>
    <div class="text-sm text-gray-600">ç‡Ÿæ¥­æ™‚é–“ï¼š{{ cart.store.opening_time }}<span>~</span>{{ cart.store.closing_time }}</div>
    <div class="text-sm text-gray-600">
      <span>è·é›¢ï¼š2.1 å…¬é‡Œ</span>ã€€ï½œã€€ <a href="https://www.google.com/maps/search/?api=1&query={{ cart.store.name|urlencode }}+near+" class="font-bold text-blue-600 hover:underline">{{ cart.store.address }}</a>ã€€ï½œã€€ ğŸ“
      <a href="tel:{{ cart.store.phone_number|cut:'-' }}" class="font-bold text-blue-600 hover:underline">{{ cart.store.phone_number }}</a>
    </div>
  </div>
</div>

<!-- å•†å“æ˜ç´° -->
<div class="space-y-4">
  {% for item in cart_item %}
  <div id="cart-item-{{ item.id }}" x-data="cartItem({{ item.quantity }}, '{{ item.id }}', '{% url 'carts:update_cart_item' item.id %}', {{ item.product.quantity }})" class="flex flex-col md:flex-row md:items-center md:justify-between border rounded-lg p-4 space-y-4 md:space-y-0 md:space-x-4">
    <!-- å•†å“åœ–ç‰‡ -->
    <div class="flex-shrink-0 self-center md:self-auto">
      {% if item.product.image %}
      <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}" class="w-24 h-24 object-cover rounded-md border border-gray-200" />
      {% else %}
      <div class="w-24 h-24 bg-gray-100 flex items-center justify-center text-gray-400 text-sm rounded-md border">ç„¡åœ–ç‰‡</div>
      {% endif %}
    </div>

    <!-- å•†å“è³‡è¨Šèˆ‡äº’å‹• -->
    <div class="flex flex-1 flex-col md:flex-row md:items-center md:justify-between w-full space-y-2 md:space-y-0">
      <!-- å•†å“åç¨±èˆ‡åƒ¹æ ¼ -->
      <div class="text-center md:text-left">
        <p class="text-lg font-medium">{{ item.product.name }}</p>
        <p class="text-gray-600 mt-1">$ {{ item.product.price }}</p>
      </div>

      <!-- æ•¸é‡èˆ‡åˆªé™¤ -->
      <div class="flex items-center justify-end space-x-4 gap-5 w-full md:w-auto">
        <!-- æ•¸é‡ -->
        <label for="{{ item.id }}_edit_qty" class="sr-only">æ•¸é‡</label>
        <div>
          <input id="{{ item.id }}_edit_qty" type="number" min="1" x-model.number="qty" @blur="isDelete" @keydown.enter.prevent="isDelete"
          class="w-20 border rounded-md px-2 py-1 text-center" />
          <span class="text-gray-600">ä»¶</span>
        </div>

        <!-- åˆªé™¤æŒ‰éˆ• -->
        <form action="{% url 'carts:delete_cart_item' item.id %}" method="post" onsubmit="return confirm('ç¢ºèªåˆªé™¤å•†å“ï¼Ÿ')">
          {% csrf_token %}
          <button type="submit" class="text-red-600 hover:text-red-700 text-2xl transition-colors">
            <i class="fas fa-trash"></i>
          </button>
        </form>
      </div>
    </div>
  </div>
  {% endfor %}
</div>

<!-- ç¸½é‡‘é¡å€å¡Š -->
<div class="mt-8 flex flex-col md:flex-row md:items-center md:justify-between">
  <div class="text-lg font-semibold text-right md:text-left mb-4 md:mb-0">
    ç¸½é‡‘é¡ï¼š<span id="totalPrice">{{ cart.calculate_total_price }}</span> å…ƒ
  </div>

  <!-- Alpine åŒ…è£¹å€å¡Š -->
  <div x-data="{
    proceedCheckout() {
      // è§¸ç™¼æ‰€æœ‰ input çš„ blur
      document.querySelectorAll('input[id$=_edit_qty]').forEach(input => input.blur());

      // ç¨ç­‰ 300ms å†è·³è½‰
      setTimeout(() => {
        window.location.href = '{% url "orders:new" %}?cart_id={{ cart.id }}';
      }, 300);
    }
  }">
    <button @click="proceedCheckout"
      class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg text-lg shadow-md">
      çµå¸³
    </button>
  </div>
</div>
{% endblock main %}
